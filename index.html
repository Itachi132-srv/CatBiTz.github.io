<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>City Drive Pro</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;background:#000;font-family:Arial}
#menu{position:fixed;inset:0;background:#000;color:#fff;
display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px}
button{padding:12px 20px;font-size:18px}
#ui{position:fixed;top:10px;left:10px;color:white}
.controls{position:fixed;bottom:0;width:100%;display:flex;justify-content:space-between;padding:20px;box-sizing:border-box}
.ctrl{background:#ffffff22;border:none;color:white;font-size:20px;padding:15px}
</style>
</head>
<body>

<div id="menu">
<h1>CITY DRIVE PRO</h1>
<button onclick="startGame()">START</button>
<button onclick="rotate()">ROTATE</button>
</div>

<div id="ui">Speed:<span id="spd">0</span> Score:<span id="score">0</span> HP:<span id="hp">100</span></div>

<div class="controls">
<div>
<button class="ctrl" ontouchstart="keys.left=1" ontouchend="keys.left=0">◀</button>
<button class="ctrl" ontouchstart="keys.right=1" ontouchend="keys.right=0">▶</button>
</div>
<div>
<button class="ctrl" ontouchstart="keys.up=1" ontouchend="keys.up=0">▲</button>
<button class="ctrl" ontouchstart="keys.down=1" ontouchend="keys.down=0">▼</button>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>
let scene,camera,renderer,car;
let speed=0,health=100,score=0;
let keys={},running=false;
let coins=[],traffic=[];
let heading=0;

function rotate(){
if(screen.orientation && screen.orientation.lock)
screen.orientation.lock("landscape").catch(()=>{});
}

function startGame(){
document.getElementById("menu").style.display="none";
init(); running=true; animate();
}

function init(){

scene=new THREE.Scene();

camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

let light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,5);
scene.add(light);

let ground=new THREE.Mesh(
new THREE.PlaneGeometry(600,600),
new THREE.MeshStandardMaterial({color:0x222222})
);
ground.rotation.x=-Math.PI/2;
scene.add(ground);

// roads grid
for(let i=-250;i<=250;i+=40){
let road=new THREE.Mesh(
new THREE.PlaneGeometry(20,600),
new THREE.MeshStandardMaterial({color:0x555555})
);
road.rotation.x=-Math.PI/2;
road.position.x=i;
scene.add(road);

let road2=road.clone();
road2.rotation.z=Math.PI/2;
road2.position.set(0,0.01,i);
scene.add(road2);
}

// buildings
for(let i=0;i<120;i++){
let b=new THREE.Mesh(
new THREE.BoxGeometry(10,Math.random()*40+10,10),
new THREE.MeshStandardMaterial({color:0x777777})
);
b.position.set(Math.random()*500-250,5,Math.random()*500-250);
scene.add(b);
}

// better car model
car=new THREE.Group();

let body=new THREE.Mesh(
new THREE.BoxGeometry(2,0.7,4),
new THREE.MeshStandardMaterial({color:0xff0000})
);
let top=new THREE.Mesh(
new THREE.BoxGeometry(1.5,0.7,2),
new THREE.MeshStandardMaterial({color:0xaa0000})
);
top.position.y=0.7;

let wheelGeo=new THREE.CylinderGeometry(0.4,0.4,0.5,16);
let wheelMat=new THREE.MeshStandardMaterial({color:0x111111});

function wheel(x,z){
let w=new THREE.Mesh(wheelGeo,wheelMat);
w.rotation.z=Math.PI/2;
w.position.set(x,-0.3,z);
car.add(w);
}
wheel(1,1.5);wheel(-1,1.5);wheel(1,-1.5);wheel(-1,-1.5);

car.add(body);
body.add(top);
car.position.y=1;
scene.add(car);

// coins
for(let i=0;i<40;i++){
let c=new THREE.Mesh(
new THREE.BoxGeometry(1,1,1),
new THREE.MeshStandardMaterial({color:0xffff00})
);
c.position.set(Math.random()*400-200,1,Math.random()*400-200);
scene.add(c); coins.push(c);
}

// traffic
for(let i=0;i<20;i++){
let t=new THREE.Mesh(
new THREE.BoxGeometry(2,1,4),
new THREE.MeshStandardMaterial({color:0x00ff00})
);
t.position.set(Math.random()*400-200,1,Math.random()*400-200);
scene.add(t); traffic.push(t);
}

camera.position.set(0,8,12);
}

function update(){

if(keys.up)speed+=0.01;
if(keys.down)speed-=0.02;
speed*=0.98;
speed=Math.max(-0.5,Math.min(speed,1.5));

if(keys.left)heading+=0.04;
if(keys.right)heading-=0.04;

car.rotation.y=heading;

car.position.x+=Math.sin(heading)*speed*3;
car.position.z+=Math.cos(heading)*speed*3;

coins.forEach(c=>{
if(c.visible && car.position.distanceTo(c.position)<2){
c.visible=false; score+=10;
}
});

traffic.forEach(t=>{
if(car.position.distanceTo(t.position)<3)health-=0.2;
});

if(health<=0){alert("Game Over");location.reload();}

document.getElementById("spd").innerText=(speed*100).toFixed(0);
document.getElementById("hp").innerText=health.toFixed(0);
document.getElementById("score").innerText=score;

let camOffset=new THREE.Vector3(
Math.sin(heading)*-12,8,Math.cos(heading)*-12);
camera.position.copy(car.position.clone().add(camOffset));
camera.lookAt(car.position);
}

function animate(){
if(!running)return;
requestAnimationFrame(animate);
update();
renderer.render(scene,camera);
}

window.addEventListener("keydown",e=>{
if(e.key==="ArrowUp")keys.up=1;
if(e.key==="ArrowDown")keys.down=1;
if(e.key==="ArrowLeft")keys.left=1;
if(e.key==="ArrowRight")keys.right=1;
});
window.addEventListener("keyup",()=>keys={});

</script>
</body>
</html>
